Palette.Manager=function(t){if(!(t instanceof WebGLRenderingContext))throw new TypeError("Error: attempted to create Palette with illegal argument.");this.context=t,this.vertShaders={},this.fragShaders={},this.programs={},this.shaderFactory=new Palette.ShaderFactory(this)},Palette.Manager.prototype={addShader:function(t){this.shaderFactory.addShader(t)},draw:function(t,e,a,r,h){this.getProgram(t,e).draw(a,r,h)},getProgram:function(t,e){return this.programs[t][e]},getShader:function(t,e){return t===Palette.Shader.VS?this.vertShaders[e]:this.fragShaders[e]}},Palette.Manager.prototype.constructor=Palette.Manager;var Palette=Palette||{};Palette.Program=function(t,e,a){this.context=t,this.vs=e,this.fs=a,this.program=null,this.compiled=!1,this.attrStore={vs:null,fs:null},this.linkProgram(),this.prepareAttrStores()},Palette.Program.prototype={draw:function(){},restoreDefaultConfig:function(){},setConfig:function(){},linkProgram:function(){return this.compiled?!1:(this.compiled=!0,this.program=this.context.createProgram(),this.context.attachShader(this.program,this.vs.shader),this.context.attachShader(this.program,this.fs.shader),this.context.linkProgram(this.program),!0)},prepareAttrStores:function(){}},Palette.Program.VS_MODE=0,Palette.Program.FS_MODE=1,Palette.Program.BOTH_MODE=2,Palette.Program.prototype.constructor=Palette.Program,Palette.Shader=function(t,e,a,r,h){this.name=e,this.type=a,this.context=t,this.attrs=h,this.shader=null,this.compiled=!1,this.bakeShader(r)},Palette.Shader.prototype={bakeShader:function(t){if(this.compiled)return null;switch(this.compiled=!0,this.type){case Palette.Shader.VS:this.shader=this.context.createShader(this.context.VERTEX_SHADER);break;case Palette.Shader.FS:this.shader=this.context.createShader(this.context.FRAGMENT_SHADER);break;default:return!1}return this.context.shaderSource(this.shader,t),this.context.compileShader(this.shader),this.context.getShaderParameter(this.shader,this.context.COMPILE_STATUS)?!0:(alert("An error occurred compiling the shaders: "+this.context.getShaderInfoLog(this.shader)),!1)}},Palette.Shader.VS=0,Palette.Shader.FS=1,Palette.Shader.LIST=2,Palette.Shader.prototype.constructor=Palette.Shader,Palette.ShaderFactory=function(t){this.manager=t},Palette.ShaderFactory.prototype={addShader:function(t){var e,a;switch(this.establishType(t)){case Palette.ShaderFactory.SOURCE_OBJECT:e=t;case Palette.ShaderFactory.JSON:e=e||JSON.parse(t),a=this.createShaderObject(e);break;case Palette.ShaderFactory.SHADER_OBJECT:a=t;break;case Palette.ShaderFactory.URL:this.downloadFromURL(t);break;default:throw new Error("Not a valid type of shader.")}a&&this.registerShader(a)},createShaderObject:function(t){switch(t.type){case Palette.Shader.VS:case Palette.Shader.FS:return new Palette.Shader(this.manager.context,t.name,t.type,t.src,t.attrs);case Palette.Shader.LIST:for(var e=t.content.length-1;e>=0;e--)this.addShader(t.content[e]);break;default:throw new Error("Tried to create an illegal class of shader.")}},downloadFromURL:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.onload=function(){this.addShader(e.response)},e.send()},establishType:function(t){var e=-1;return t instanceof Palette.Shader?e=Palette.ShaderFactory.SHADER_OBJECT:t.type&&t.name&&(t.content||t.src)?e=Palette.ShaderFactory.SOURCE_OBJECT:this.isJSON(t)?e=Palette.ShaderFactory.JSON:t instanceof String&&(e=Palette.ShaderFactory.URL),e},isJSON:function(t){try{return JSON.parse(t),!0}catch(e){return!1}},registerShader:function(t){switch(t.type){case Palette.Shader.VS:this.manager.vertShaders[t.name]=this.manager.vertShaders[t.name]||t;break;case Palette.Shader.FS:this.manager.fragShaders[t.name]=this.manager.fragShaders[t.name]||t;break;default:throw new Error("Tried to register an illegal class of shader.")}}},Palette.ShaderFactory.SOURCE_OBJECT=0,Palette.ShaderFactory.JSON=1,Palette.ShaderFactory.URL=2,Palette.ShaderFactory.SHADER_OBJECT=3,Palette.ShaderFactory.prototype.constructor=Palette.ShaderFactory;