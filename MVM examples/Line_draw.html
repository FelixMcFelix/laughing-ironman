<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../build/Palette.js"></script>
	<script type="text/javascript" src="../src/MVM/MVM.js"></script>	
</head>
<body>
	<canvas id="mvm-can" width="800" height="600"></canvas>
<script type="text/javascript">
window.onload = function(){
	var can = document.getElementById("mvm-can");
	var glctx = can.getContext("webgl",{preserveDrawingBuffer:true});
	var manager = new Palette.Manager(glctx);

	var shaderStore = '{'+
	'"type": 2,' +
	'"content": [' +
		'{' +
			'"type": 0,' +
			'"name": "square",' +
			'"src": "\u0023version 100\\n attribute vec3 aVertexPos;\\nvoid main(){gl_Position = vec4(aVertexPos, 1.0);}",' +
			'"attrs": [' +
				'[' +
					'"aVertexPos",' +
					'"vertexAttrib",' +
					'"vertexBuffer"' +
				'],' +
				'[' +
					'"vertexBuffer",' +
					'"buffer",' +
					'3' +
				']' +
			']' +
		'},' +
		'{' +
			'"type": 1,' +
			'"name": "square",' +
			'"src": "\u0023version 100\\n precision mediump float;\\n uniform vec4 color;\\n void main(){gl_FragColor = color;}",' +
			'"attrs": [' +
				'[' +
					'"color",' +
					'"vec4",' +
					'[' +
						'0,' +
						'1,' +
						'0,' +
						'1' +
					']' +
				']' +
			']' +
		'}' +
	']' +
'}'

	manager.addShader(shaderStore);
	
	var line1 = [
		[-0.5,0.5],
		[0.5,0.5],
		[0.0,1.0,0.0,1.0]
	];
	var line2 = [
		[0.5,-0.5],
		[-0.5,-0.5],
		[0.0,1.0,0.0,1.0]
	];
	var line3 = [
		[0.5,-0.5],
		[0.5,0.5],
		[0.0,1.0,0.0,1.0]
	];
	var line4 = [
		[-0.5,-0.5],
		[-0.5,0.5],
		[0.0,1.0,0.0,1.0]
	];
	/*var line1 = [
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[0.0,0.0,0.0,1.0]
	];
	var line2 = [
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[0.0,0.0,0.0,1.0]
	];
	var line3 = [
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[(Math.random() * 2) - 1,(Math.random() * 2) - 1],
		[0.0,0.0,0.0,1.0]
	];*/
	var constantPool = [line1,line2,line3,line4];
	var codeStore = [101,4,0,21,4,1,21,4,2,21,4,3,21,22];
	//mvm.interpret(1,codeStore);
	window.mvm = new MVM(glctx, manager, codeStore, constantPool, 0);
	window.mvm.interpret();
}
</script>
</body>

</html>