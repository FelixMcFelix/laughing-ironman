<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../build/Palette.js"></script>
	<script type="text/javascript" src="../src/MVM/MVM.js"></script>	
</head>
<body>
	<canvas id="mvm-can" width="800" height="600"></canvas>
<script type="text/javascript">
window.onload = function(){
	var can = document.getElementById("mvm-can");
	var glctx = can.getContext("webgl");
	var manager = new Palette.Manager(glctx);

	var shaderStore = '{'+
	'"type": 2,' +
	'"content": [' +
		'{' +
			'"type": 0,' +
			'"name": "square",' +
			'"src": "\u0023version 100\\n attribute vec3 aVertexPos;\\nvoid main(){gl_Position = vec4(aVertexPos, 1.0);}",' +
			'"attrs": [' +
				'[' +
					'"aVertexPos",' +
					'"vertexAttrib",' +
					'"vertexBuffer"' +
				'],' +
				'[' +
					'"vertexBuffer",' +
					'"buffer",' +
					'3' +
				']' +
			']' +
		'},' +
		'{' +
			'"type": 1,' +
			'"name": "square",' +
			'"src": "\u0023version 100\\n precision mediump float;\\n uniform vec4 color;\\n void main(){gl_FragColor = color;}",' +
			'"attrs": [' +
				'[' +
					'"color",' +
					'"vec4",' +
					'[' +
						'0,' +
						'1,' +
						'0,' +
						'1' +
					']' +
				']' +
			']' +
		'}' +
	']' +
'}'

	manager.addShader(shaderStore);
	
	var mvm = new MVM(glctx, manager);
	/*var codeStore = 	[mvm.opCodes.LOADC,		16,
						 mvm.opCodes.STOREG,	0,		// 	LIMIT = 10
						 mvm.opCodes.LOADC,		0,
						 mvm.opCodes.STOREL,	0,		//	i = 0
						 mvm.opCodes.LOADC,		2,
						 mvm.opCodes.STOREL,	1,		//	j = 1
						 mvm.opCodes.LOADL,		0,
						 mvm.opCodes.LOADG,		0,
						 mvm.opCodes.NCMPLT,			//	i < LIMIT
						 mvm.opCodes.JUMPF,		35,
						 mvm.opCodes.LOADL,		1,
						 mvm.opCodes.LOADC,		2,
						 mvm.opCodes.IMUL,
						 mvm.opCodes.STOREL,	1,		//	j = j * 2
						 mvm.opCodes.LOADL,		0,
						 mvm.opCodes.LOADC,		1,
						 mvm.opCodes.IADD,
						 mvm.opCodes.STOREL,	0,		//	i++
						 mvm.opCodes.JUMP,		12,		//	JUMP
						 mvm.opCodes.LOADL,		1,
						 999];*/
	var codeStore = [21];
	//mvm.interpret(1,codeStore);
	setInterval(function(){mvm.interpret(1,codeStore);},16);
}
</script>
</body>

</html>