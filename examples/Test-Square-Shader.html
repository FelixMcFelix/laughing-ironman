<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../build/Palette.js" ></script>
        <script type="text/javascript" src="gl-matrix-min.js"></script>
		<script type="text/javascript">
			window.onload = function(){
				x = new XMLHttpRequest();
				x.open("GET", "https://dl.dropboxusercontent.com/u/15574345/laughing-ironman/examples/squareShaders.json", true);
				x.onload = function(){
					execute(x.response);
				};
				x.send();
			}
			
			execute = function(text){
				var canvas = document.getElementById("testingcanvas");
				var glctx = canvas.getContext("webgl");

				var pvMatrix = [];
				var mvMatrix = [];
				mat4.perspective(pvMatrix, Math.PI/4, canvas.width/canvas.height, 0.1, 100);
				mat4.identity(mvMatrix);

				//var squareVtx = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);
				var squareVtx = new Float32Array([0, 0, 0,
												  0, 1.0, 0,
												  0, 1.0, 1.0]);

				var manager = new Palette.Manager(glctx);
				//manager.addShader("squareShaders.json");
                manager.addShader(text);

				var raf = function(){
					debugger;
					manager.draw("square", "square", squareVtx, {pvMatrix: pvMatrix, mvMatrix: mvMatrix}, {color: [1.0, 0.0, 0.0, 1.0]});
					window.requestAnimationFrame(raf);
				}

				window.requestAnimationFrame(raf);
			}
		</script>
	</head>
	<body>
		<canvas id="testingcanvas" width="800" height="600">Get a modern browser you spoon!</canvas>
	</body>
</html>
