<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: MVM/MVM-DataModel.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: MVM/MVM-DataModel.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @namespace MVM
 */

var MVM = MVM || {};


/**
 * @classdesc The data management subsystem of MVM. It works by maintaining a stack of scope frames - themselves parts of a wider scope tree. Variable modifications are made by chaining up parent scopes when necessary.
 * @class MVM.DataModel
 * @public
 * @author FelixMcFelix (Kyle S.)
 */
MVM.DataModel = function(){
	this.root = new MVM.DataModel.StackFrame(null);
	this.stack = [this.root];
}

MVM.DataModel.prototype = {
	current: function(){
		try{
			return this.stack[this.stack.length - 1];
		} catch(e){
			return undefined;
		}
	},

	relative: function(count){
		var cursor = this.current();
		while(count>0 &amp;&amp; cursor &amp;&amp; cursor.parent){
			cursor = cursor.parent;
			count--;
		}

		if(count>0) throw "Invalid relative call - too few parents.";

		return cursor;
	},

	enter: function(){
		var tmp = new MVM.DataModel.StackFrame(this.current());
		this.stack[this.stack.length - 1] = tmp;

		return this;
	},

	exit: function(){
		if(this.current() !== this.root){
			this.stack[this.stack.length - 1] = this.current().parent;
		} else{
			throw "Tried to exit from scope past root level."
		}

		return this;
	},

	call: function(argc, rel, ret){
		var prev = this.current();
		var parent = this.relative(rel);
		this.stack.push(new MVM.DataModel.StackFrame(parent));

		var c = this.current();
		c.returnAddr = ret;

		while (argc>0){
			c.setVar(argc-1, prev.pop());	
			argc--;
		}

		return this;
	},

	funcreturn: function(value){
		var p = this.stack.pop();
		
		if (value!==null) {
			this.current().push(value);
		};

		return p.returnAddr;
	}
}

/**
 * @classdesc An individual stack frame used by the {@link MVM.DataModel}.
 * @class MVM.DataModel.StackFrame
 * @public
 * @author FelixMcFelix (Kyle S.)
 */
MVM.DataModel.StackFrame = function(parent){
	this.parent = parent;
	this.variables = [];
	this.stack = [];
	this.returnAddr = undefined;
}

MVM.DataModel.StackFrame.prototype = {
	push: function(value){
		this.stack.push(value);

		return this;
	},

	pop: function(){
		return this.stack.pop();
	},

	peek: function(){
		try {
			return this.stack[this.stack.length-1];
		} catch (e){
			return undefined;
		}
	},

	setVar: function(varNo, val){
		this.variables[varNo] = val;

		return this;
	},

	getVar: function(varNo){
		return this.variables[varNo];
	}
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="MVM.DataModel.html">DataModel</a></li><li><a href="MVM.DataModel.StackFrame.html">StackFrame</a></li><li><a href="MVM.VM.html">VM</a></li><li><a href="Palette.Manager.html">Manager</a></li><li><a href="Palette.Program.html">Program</a></li><li><a href="Palette.Shader.html">Shader</a></li><li><a href="Palette.ShaderFactory.html">ShaderFactory</a></li><li><a href="Sketch.Driver.html">Driver</a></li><li><a href="Sketch.EnumBase.html">EnumBase</a></li><li><a href="Sketch.SketchGen.html">SketchGen</a></li><li><a href="Sketch.SketchGen.Label.html">Label</a></li><li><a href="Sketch.SketchGen.html#ScopeStackFrame">ScopeStackFrame</a></li></ul><h3>Namespaces</h3><ul><li><a href="MVM.html">MVM</a></li><li><a href="Palette.html">Palette</a></li><li><a href="Sketch.html">Sketch</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Sun Sep 20 2015 15:58:05 GMT+0100 (GMT Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
